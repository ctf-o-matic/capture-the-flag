{% extends "base.html" %}

{% block pagetitle %}Capture The Flag{% endblock %}

{% block keywords %}{% endblock %}

{% block description %}{% endblock %}

{% block content %}

<div class="jumbotron bg-transparent mb-0 radius-0">
  <div class="container">
      <div class="row">
        <div class="col-xl-12">
            {% if team %}
              {% include 'leaderboard/form-errors.html' %}

              <h1>Team: {{team.name}}</h1>

              <p>Members:</p>
              <ul>
                {% for tm in team.teammember_set.all %}
                <li>{{ tm.user.get_full_name }}</li>
                {% endfor %}
              </ul>

                {% if user_can_leave %}
                    <div class="alert alert-warning d-flex justify-content-between align-items-center">
                        While the team has not submitted a solution, you may still leave this team to join another team, if needed.
                        <a href="{% url 'leaderboard:leave-team' %}" class="btn btn-warning">Leave team</a>
                    </div>
                {% endif %}
            {% else %}
              <div class="alert alert-info">
                <div>You are not in a team, yet. Only teams can submit solutions.</div>
                <div>
                    {% if available_teams %}
                        You can either join one of the available teams, or create a new team.
                    {% else %}
                        There are no available teams, yet. You can go ahead and create one.
                    {% endif %}
                </div>
              </div>

                {% if available_teams %}
                    <h2 class="mb-3 mt-3">Available teams</h2>
                    {% if join_error %}
                        <div class="alert alert-warning">
                            {% if join_error == "team-missing" %}
                                Sorry, it seems the team you selected has disappeared...
                            {% elif join_error == "team-full" %}
                                Sorry, it seems the team you selected is no longer available (no more slots)...
                            {% elif join_error == "team-has-submissions" %}
                                Sorry, it seems the team you selected is no longer available (has already submissions)...
                            {% else %}
                                Unknown error: {{ join_error }}
                            {% endif %}
                            Please choose another team!
                        </div>
                    {% endif %}

                    <table class="table table-hover table-dark">
                      <thead>
                        <tr>
                          <th scope="col">Team</th>
                          <th scope="col">Members</th>
                          <th scope="col">Join?</th>
                        </tr>
                      </thead>
                      <tbody>
                    {% for team in available_teams %}
                        <tr>
                          <td>{{team}}</td>
                          <td>
                            {% for tm in team.teammember_set.all %}
                                <div>{{ tm.user }}</div>
                            {% endfor %}
                          </td>
                          <td><a href="{% url 'leaderboard:join-team' team.pk %}" class="btn btn-secondary">Join this team</a></td>
                        </tr>
                    {% endfor %}
                      </tbody>
                    </table>
                {% elif join_error %}
                    <h2 class="mb-3 mt-3">Available teams</h2>
                    <div class="alert alert-warning">
                        Sorry, it seems the team you selected is no longer available.
                        In fact there are no more available teams.
                        At the moment you have no choice but to create your own!
                    </div>
                {% endif %}

              <h2>Create a new team</h2>

              {% include 'leaderboard/form-errors.html' %}

              <form method="post" action="{% url 'leaderboard:create-team' %}" class="needs-validation" novalidate>
                  {% csrf_token %}
                <div class="form-row align-items-center">
                  <div class="col-sm-4">
                    <input name="team_name" type="text" class="form-control" placeholder="Team name to create, ex: Foo Fighters" required>
                    <div class="invalid-feedback">Please enter a name for the team.</div>
                  </div>
                  <div class="col-auto">
                    <button class="btn btn-primary" type="submit">Create team</button>
                  </div>
                </div>
              </form>

              {% include 'leaderboard/form-frontend-validations.html' %}

            {% endif %}

        </div>
      </div>
  </div>
</div>

{% endblock %}
