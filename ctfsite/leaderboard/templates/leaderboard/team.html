{% extends "base.html" %}

{% block pagetitle %}Capture The Flag{% endblock %}

{% block keywords %}{% endblock %}

{% block description %}{% endblock %}

{% block content %}

<div class="jumbotron bg-transparent mb-0 radius-0">
  <div class="container">
      <div class="row">
        <div class="col-xl-12">
          <h1>Team: {% if team %}{{team.name}}{% else %}None{% endif %}</h1>

            {% if team %}
              {% include 'leaderboard/form-errors.html' %}
                <p>Members:</p>
                <ul>
                    {% for tm in team.teammember_set.all %}
                    <li>{{ tm.user.get_full_name }}</li>
                    {% endfor %}
                </ul>

                {% if user_can_leave %}
                    <div class="alert alert-warning d-flex justify-content-between align-items-center">
                        While the team has not submitted a solution, you may leave to join another team, if needed.
                        <a href="{% url 'leaderboard:leave-team' %}" class="btn btn-warning">Leave team</a>
                    </div>
                {% endif %}
            {% else %}
          <p class="text-grey">
            You are not in a team, yet. Only teams can submit solutions.
          </p>
          <p class="text-grey">
              {% if available_teams %}
              You can either join an existing team with available spots, or create a new one.
              {% else %}
              It looks like there are no available teams. You can go ahead and create one.
              {% endif %}
          </p>

          <form method="post" action="{% url 'leaderboard:create-team' %}" class="needs-validation" novalidate>
              {% csrf_token %}
              {% include 'leaderboard/form-errors.html' %}
            <div class="form-row align-items-center">
              <div class="col-sm-4">
                <input name="team_name" type="text" class="form-control" placeholder="Team name to create, ex: Foo Fighters" required>
                <div class="invalid-feedback">Please enter a name for the team.</div>
              </div>
              <div class="col-auto">
                <button class="btn btn-primary" type="submit">Create team</button>
              </div>
            </div>
          </form>

            <script>
            (function() {
              'use strict';
              window.addEventListener('load', function() {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                  form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                      event.preventDefault();
                      event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                  }, false);
                });
              }, false);
            })();
            </script>

                {% if available_teams %}
                    <h2 class="mb-3 mt-3">Available teams</h2>
                    {% if join_error %}
                        <div class="alert alert-warning">
                            {% if join_error == "team-missing" %}
                                Sorry, it seems the team you selected has disappeared...
                            {% elif join_error == "team-full" %}
                                Sorry, it seems the team you selected is no longer available (no more slots)...
                            {% elif join_error == "team-has-submissions" %}
                                Sorry, it seems the team you selected is no longer available (has already submissions)...
                            {% else %}
                                Unknown error: {{ join_error }}
                            {% endif %}
                            Please choose another team!
                        </div>
                    {% endif %}

                    <table class="table table-hover table-dark">
                      <thead>
                        <tr>
                          <th scope="col">Team</th>
                          <th scope="col">Members</th>
                          <th scope="col">Join?</th>
                        </tr>
                      </thead>
                      <tbody>
                    {% for team in available_teams %}
                        <tr>
                          <td>{{team}}</td>
                          <td>
                            {% for tm in team.teammember_set.all %}
                                <div>{{ tm.user }}</div>
                            {% endfor %}
                          </td>
                          <td><a href="{% url 'leaderboard:join-team' team.pk %}" class="btn btn-secondary">Join this team</a></td>
                        </tr>
                    {% endfor %}
                      </tbody>
                    </table>
                {% elif join_error %}
                    <h2 class="mb-3 mt-3">Available teams</h2>
                    <div class="alert alert-warning">
                        Sorry, it seems the team you selected is no longer available.
                        In fact there are no more available teams.
                        At the moment you have no choice but to create your own!
                    </div>
                {% endif %}

            {% endif %}

        </div>
      </div>
  </div>
</div>

{% endblock %}
